
   -- Generate column concatenation dynamically
    SELECT @ColumnList = STRING_AGG(CONCAT(''' | ', COLUMN_NAME, ': ''', ' + CAST([' + COLUMN_NAME + '] AS NVARCHAR(MAX))'), ', ')
    FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = @TableName AND COLUMN_NAME <> 'ID';



DECLARE @Tables TABLE (TableName NVARCHAR(100));

INSERT INTO @Tables (TableName)
SELECT TABLE_NAME 
FROM INFORMATION_SCHEMA.TABLES
WHERE TABLE_TYPE = 'BASE TABLE';


CREATE TABLE X (
    ID INT PRIMARY KEY,
    Column2 NVARCHAR(MAX) NULL,
    ConcatenatedData NVARCHAR(MAX)
);


DECLARE @TableName NVARCHAR(100), @SQL NVARCHAR(MAX), @ColumnList NVARCHAR(MAX);
DECLARE @Tables TABLE (TableName NVARCHAR(100));
INSERT INTO @Tables VALUES ('Table1'), ('Table2'), ('Table3'), ('Table4'), ('Table5');

-- Iterate over each table
DECLARE TableCursor CURSOR FOR SELECT TableName FROM @Tables;
OPEN TableCursor;
FETCH NEXT FROM TableCursor INTO @TableName;

WHILE @@FETCH_STATUS = 0
BEGIN
    -- Generate column concatenation
    SELECT @ColumnList = STRING_AGG(''' | ' + COLUMN_NAME + ': '' + CAST([' + COLUMN_NAME + '] AS NVARCHAR(MAX))', '') 
    FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = @TableName AND COLUMN_NAME <> 'ID';

    -- Generate dynamic SQL for each table
    SET @SQL = 'INSERT INTO X (ID, Column2, ConcatenatedData)
                SELECT ID, NULL, (SELECT ' + @ColumnList + ' FROM ' + @TableName + ' FOR XML PATH('''')) FROM ' + @TableName;

    EXEC sp_executesql @SQL;
    
    FETCH NEXT FROM TableCursor INTO @TableName;
END;

CLOSE TableCursor;
DEALLOCATE TableCursor;


UPDATE ZZ
SET ZZ.value2 = X.ConcatenatedData
FROM ZZ
JOIN X ON ZZ.ID = X.ID;


